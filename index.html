<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assembly</title>

    <!-- Early console capture - must be first! -->
    <script>
        // Capture ALL console output from the very beginning
        window.earlyLogs = [];
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;
        const originalInfo = console.info;

        function captureConsoleOutput(type, args) {
            // Get call stack information
            const stack = new Error().stack;
            const stackLines = stack ? stack.split('\n').slice(2) : []; // Skip Error constructor and this function

            // Parse stack to get file and line info
            const callInfo = stackLines.map(line => {
                const match = line.match(/at\s+(.+?)\s+\((.+?):(\d+):(\d+)\)/);
                if (match) {
                    return {
                        function: match[1],
                        file: match[2],
                        line: parseInt(match[3]),
                        column: parseInt(match[4])
                    };
                }
                // Handle anonymous functions
                const anonMatch = line.match(/at\s+(.+?):(\d+):(\d+)/);
                if (anonMatch) {
                    return {
                        function: '(anonymous)',
                        file: anonMatch[1],
                        line: parseInt(anonMatch[2]),
                        column: parseInt(anonMatch[3])
                    };
                }
                return null;
            }).filter(Boolean);

            window.earlyLogs.push({
                type,
                args,
                timestamp: new Date().toISOString(),
                callStack: callInfo
            });
        }

        console.log = function (...args) {
            originalLog.apply(console, args);
            captureConsoleOutput('LOG', args);
        };

        console.warn = function (...args) {
            originalWarn.apply(console, args);
            captureConsoleOutput('WARN', args);
        };

        console.error = function (...args) {
            originalError.apply(console, args);
            captureConsoleOutput('ERROR', args);
        };

        console.info = function (...args) {
            originalInfo.apply(console, args);
            captureConsoleOutput('INFO', args);
        };
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üéõÔ∏è</text></svg>">
    <style>
        /* Add any custom CSS here */
        .playback-btn {
            @apply text-xl px-2 py-1 rounded hover:bg-gray-700 focus:outline-none;
        }

        .clip-block {
            @apply rounded px-2 py-1 text-sm font-medium cursor-move select-none shadow;
        }

        .clip-block.selected {
            @apply ring-2 ring-teal-400;
        }

        .clip-handle {
            @apply absolute top-0 bottom-0 w-2 cursor-ew-resize;
        }

        .track-row {
            @apply flex items-center border-b border-gray-800 bg-gray-900 hover:bg-gray-800 transition;
        }

        .track-controls {
            @apply flex items-center w-20 justify-start px-2;
        }

        .track-name {
            @apply flex-1 font-semibold text-base px-2 py-1 bg-transparent border-none outline-none;
        }

        .mute-btn,
        .solo-btn {
            @apply text-lg px-1 py-1 rounded hover:bg-gray-700 focus:outline-none;
        }

        .timeline-track {
            @apply flex-1 relative min-h-[48px] h-16 flex items-center overflow-x-auto bg-teal-800 border border-teal-700 rounded shadow-md transition;
        }

        .snapping-grid {
            @apply absolute top-0 left-0 h-full w-full pointer-events-none;
        }

        .grid-line {
            @apply absolute top-0 bottom-0 w-px bg-teal-800 opacity-40;
        }
    </style>
</head>

<body class="bg-gray-900 text-gray-100 min-h-screen">
    <!-- Logging system must remain at the top -->
    <script src="app.js"></script>
    <div class="flex flex-col h-screen">
        <!-- Top Bar -->
        <div class="flex items-center bg-gray-800 px-4 py-2 border-b border-gray-700">
            <div class="top-bar-project-info"></div>
            <div class="relative mr-4">
                <button id="loadDropdownBtn"
                    class="flex items-center px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded text-sm font-medium">
                    <span class="mr-1">Load</span> <span class="text-lg">‚ñº</span>
                </button>
                <div id="loadDropdown"
                    class="hidden absolute left-0 mt-1 w-64 bg-gray-800 border border-gray-700 rounded shadow-lg z-10">
                    <button class="w-full text-left px-4 py-2 hover:bg-gray-700" data-project="a">Piece together a
                        linear sentence</button>
                    <button class="w-full text-left px-4 py-2 hover:bg-gray-700" data-project="b">Choose instrument
                        options</button>
                    <button class="w-full text-left px-4 py-2 hover:bg-gray-700" data-project="c">Vince's ambient
                        sandbox</button>
                    <button class="w-full text-left px-4 py-2 hover:bg-gray-700" data-project="d">THE SONG</button>
                </div>
            </div>
            <span class="ml-auto text-gray-400 text-sm">BPM: <span id="bpmDisplay">90</span></span>
        </div>
        <!-- Main Content -->
        <div class="flex flex-1 overflow-hidden">
            <!-- Sidebar -->
            <aside class="w-64 bg-gray-800 border-r border-gray-700 flex flex-col">
                <!-- Playback Controls -->
                <div class="flex items-center justify-between px-4 py-3 border-b border-gray-700">
                    <button class="playback-btn" title="Play/Pause" id="playBtn">‚ñ∂Ô∏è</button>
                    <button class="playback-btn" title="Stop" id="stopBtn">‚èπ</button>
                    <button class="playback-btn" title="Rewind" id="rewindBtn">‚èÆ</button>
                    <button class="playback-btn" title="Fast Forward" id="ffBtn">‚è≠</button>
                    <button class="playback-btn" title="Loop" id="loopBtn">üîÅ</button>
                </div>
                <!-- Clip Repository -->
                <div id="clipRepo" class="flex-1 overflow-y-auto p-4 space-y-6">
                    <!-- Populated by JS -->
                </div>
            </aside>
            <!-- Timeline Area -->
            <main class="flex-1 flex flex-col bg-gray-900">
                <!-- Time Ruler -->
                <div class="relative h-12 flex items-end border-b border-gray-700 bg-gray-900">
                    <div id="timeRuler" class="flex-1 h-8 flex items-end relative">
                        <!-- Populated by JS -->
                    </div>
                </div>
                <!-- Tracks List -->
                <div id="tracksContainer" class="flex-1 overflow-y-auto relative">
                    <!-- Populated by JS -->
                </div>
                <!-- Add Track Button (only for project c) -->
                <div id="addTrackBar" class="hidden px-4 py-2 border-t border-gray-700 bg-gray-800">
                    <button id="addTrackBtn"
                        class="flex items-center px-3 py-1 bg-teal-600 hover:bg-teal-500 rounded text-sm font-medium text-white">
                        <span class="mr-2">Ôºã</span> Add Track
                    </button>
                </div>
            </main>
        </div>
    </div>
</body>

</html>